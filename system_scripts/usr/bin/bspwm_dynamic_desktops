#!/bin/bash

#last_focused="$(bspc query -D -d --names)"

remove_empty_desktops() {
    bspc query -D -d '.!occupied.!active' | while read desktop_name; do
        bspc desktop $desktop_name -r
    done
}

# if desktop name is not found in list, then add this desktop to current monitor.
add_or_focus_desktop() {
    desktop_to_focus="$2"
    current_desktop_names="$(bspc query -D --names)"

    if [ -z "$(echo $current_desktop_names | grep $desktop_to_focus)" ]; then
        bspc monitor -a "$desktop_to_focus"; 
    fi

    # if we want to just focus, then simply focus. if we want to send, then send to desktop without focusing 
    case "$1" in 
        focus) 
            bspc desktop "$desktop_to_focus" -f
        ;;
        move_window_to) 
            bspc node -d "$desktop_to_focus" 
            notify-send "window moved to desktop $desktop_to_focus"
        ;;
    esac
}

monitor_scroll() {
    case "$1" in 
        inc) iterator=-1 ;; 
        dec) iterator=1 ;;
    esac

    current_desktop="$(bspc query -D focused)"
    while true; do
        if desktop_exists; then
            desktop_to_focus=
        fi
    done
    bspc query -M -
    add_or_focus_desktop
}

add_or_focus_desktop "$1" "$2"
remove_empty_desktops

# finally, if the last focused desktop we just left is empty AND we explicitly are leaving this desktop, delete it.
#if [ "$desktop_to_focus" != "$last_focused" ] && [ -z "$(bspc query -N -d $last_focused)" ]
#then 
#     bspc desktop "$last_focused" --remove 
#fi

