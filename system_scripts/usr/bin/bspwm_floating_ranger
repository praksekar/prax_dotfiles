#!/bin/bash

ranger_node="$(cat ~/.config/bspwm/ranger_node.txt)"

save_next_created_ranger() {
    bspc subscribe node_add | while read; do 
        bspc query -N -n newest > ~/.config/bspwm/ranger_node.txt
        ranger_node="$(cat ~/.config/bspwm/ranger_node.txt)"
        bspc node "$ranger_node" --state floating
        bspc node "$ranger_node" --flag locked
        break
    done
}

# create ranger desktop if not on current wm.
if [ -z "$(bspc query -D --names | grep ranger)"]
then
    bspc monitor -a ranger
fi

# if ranger node is not on current wm, then create it.
if [ -z "$(bspc query --nodes | grep $ranger_node)" ]
then 
    save_next_created_ranger &
    setsid launch_ranger &
fi

# if ranger node is on focused desktop, move ranger to ranger desktop. Otherwise, bring ranger into focus on the focused desktop.
if [ ! -z "$(bspc query --nodes --desktop | grep $ranger_node)"  ] 
then
    bspc node "$ranger_node" --to-desktop ranger
else
    bspc node "$ranger_node" --to-desktop focused
    bspc node "$ranger_node" -f 
fi

